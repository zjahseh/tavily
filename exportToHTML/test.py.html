<html>
<head>
<title>test.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test.py</font>
</center></td></tr></table>
<pre><span class="s0"># ğŸ“¦ è‡ªå‹•æ–°èæ•´åˆç³»çµ± v1.0</span>
<span class="s0"># åŠŸèƒ½ï¼šæ•´åˆ Tavily æœå°‹ + Gemini æ‘˜è¦ â†’ ç”Ÿæˆå°ç£æ¯æ—¥æ–°èç¶œåˆå ±å‘Š</span>
<span class="s0"># ğŸŒŸ ä¿®æ­£ï¼šå°‡ Google Trends æ›¿æ›ç‚º Google News RSSï¼Œä¸¦å¢åŠ  RSS å‚™æ´æ©Ÿåˆ¶ã€‚</span>

<span class="s2">import </span><span class="s1">os</span>
<span class="s2">from </span><span class="s1">dotenv </span><span class="s2">import </span><span class="s1">load_dotenv</span>
<span class="s2">from </span><span class="s1">tavily </span><span class="s2">import </span><span class="s1">TavilyClient</span>
<span class="s2">import </span><span class="s1">google</span><span class="s3">.</span><span class="s1">generativeai </span><span class="s2">as </span><span class="s1">genai</span>
<span class="s0"># import pytrends.request as TrendReq # ä¸å†éœ€è¦ pytrends</span>
<span class="s2">import </span><span class="s1">feedparser</span>
<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">import </span><span class="s1">time</span>
<span class="s2">from </span><span class="s1">google</span><span class="s3">.</span><span class="s1">generativeai </span><span class="s2">import </span><span class="s1">types</span>

<span class="s0"># ...</span>
<span class="s0"># ==========================</span>
<span class="s0"># åˆå§‹åŒ–ç’°å¢ƒè®Šæ•¸</span>
<span class="s0"># ==========================</span>
<span class="s1">load_dotenv</span><span class="s3">()</span>
<span class="s1">TAVILY_API_KEY </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">getenv</span><span class="s3">(</span><span class="s4">&quot;TAVILY_API_KEY&quot;</span><span class="s3">)</span>
<span class="s1">GOOGLE_API_KEY </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">getenv</span><span class="s3">(</span><span class="s4">&quot;GOOGLE_API_KEY&quot;</span><span class="s3">)</span>

<span class="s2">if not </span><span class="s1">TAVILY_API_KEY </span><span class="s2">or not </span><span class="s1">GOOGLE_API_KEY</span><span class="s3">:</span>
    <span class="s0"># é€™è£¡çš„éŒ¯èª¤æª¢æŸ¥æ˜¯å¿…è¦çš„ï¼Œè«‹ç¢ºä¿æ‚¨çš„ .env æ–‡ä»¶ä¸­è¨­å®šäº†é€™å…©å€‹ Key</span>
    <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">&quot;âŒ è«‹ç¢ºèªå·²åœ¨ .env æª”ä¸­è¨­å®š TAVILY_API_KEY å’Œ GOOGLE_API_KEY&quot;</span><span class="s3">)</span>

<span class="s0"># åˆå§‹åŒ–å®¢æˆ¶ç«¯</span>
<span class="s1">tavily_client </span><span class="s3">= </span><span class="s1">TavilyClient</span><span class="s3">(</span><span class="s1">api_key</span><span class="s3">=</span><span class="s1">TAVILY_API_KEY</span><span class="s3">)</span>
<span class="s1">genai</span><span class="s3">.</span><span class="s1">configure</span><span class="s3">(</span><span class="s1">api_key</span><span class="s3">=</span><span class="s1">GOOGLE_API_KEY</span><span class="s3">)</span>
<span class="s1">gemini_model </span><span class="s3">= </span><span class="s1">genai</span><span class="s3">.</span><span class="s1">GenerativeModel</span><span class="s3">(</span><span class="s4">&quot;models/gemini-2.5-flash&quot;</span><span class="s3">)</span>


<span class="s0"># ==========================</span>
<span class="s0"># Phase 1ï¼šæ¢ç´¢äº‹ä»¶</span>
<span class="s0"># ==========================</span>
<span class="s0"># ==========================</span>
<span class="s0"># Phase 0ï¼šGoogle News å°ç£é ­æ¢ RSS æå– (å¤šé‡å‚™æ´ç‰ˆ)</span>
<span class="s0"># ==========================</span>
<span class="s2">def </span><span class="s1">get_google_news_headlines</span><span class="s3">(</span><span class="s1">max_results</span><span class="s3">=</span><span class="s5">15</span><span class="s3">):</span>
    <span class="s6">&quot;&quot;&quot; 
    ä½¿ç”¨ Google News å°ç£åœ°å€çš„ RSS Feed ç²å–é ­æ¢æ–°èæ¨™é¡Œï¼Œå¤±æ•—æ™‚å˜—è©¦é€šç”¨ç‰ˆã€‚ 
    &quot;&quot;&quot;</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;ğŸ“° [Phase 0] é€é Google News å°ç£ RSS Feed ç²å–æœ€æ–°é ­æ¢...&quot;</span><span class="s3">)</span>

    <span class="s0"># 1. å°ç£ç‰¹å®š RSS URL (å„ªå…ˆå˜—è©¦)</span>
    <span class="s1">TW_RSS_URL </span><span class="s3">= </span><span class="s4">&quot;https://news.google.com/rss?hl=zh-TW&amp;gl=TW&amp;ceid=TW:zh-Hant&quot;</span>
    <span class="s0"># 2. é€šç”¨/åœ‹éš› RSS URL (ä½œç‚ºå‚™æ´)</span>
    <span class="s1">GLOBAL_RSS_URL </span><span class="s3">= </span><span class="s4">&quot;https://news.google.com/rss&quot;</span>

    <span class="s1">urls_to_try </span><span class="s3">= [</span><span class="s1">TW_RSS_URL</span><span class="s3">, </span><span class="s1">GLOBAL_RSS_URL</span><span class="s3">]</span>

    <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">url </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">urls_to_try</span><span class="s3">):</span>
        <span class="s1">source_name </span><span class="s3">= </span><span class="s4">&quot;å°ç£å°ˆå±¬ RSS&quot; </span><span class="s2">if </span><span class="s1">i </span><span class="s3">== </span><span class="s5">0 </span><span class="s2">else </span><span class="s4">&quot;é€šç”¨ RSS å‚™æ´&quot;</span>

        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">feed </span><span class="s3">= </span><span class="s1">feedparser</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">url</span><span class="s3">)</span>
            <span class="s1">headlines </span><span class="s3">= []</span>

            <span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">feed</span><span class="s3">.</span><span class="s1">entries</span><span class="s3">:</span>
                <span class="s0"># RSS feed çš„æ¨™é¡Œ (entry.title) å°±æ˜¯æ–°èæ¨™é¡Œ</span>
                <span class="s1">title </span><span class="s3">= </span><span class="s1">entry</span><span class="s3">.</span><span class="s1">title</span>
                <span class="s1">headlines</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">title</span><span class="s3">)</span>

                <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">headlines</span><span class="s3">) &gt;= </span><span class="s1">max_results</span><span class="s3">:</span>
                    <span class="s2">break</span>

            <span class="s2">if </span><span class="s1">headlines</span><span class="s3">:</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;âœ… æˆåŠŸç²å– </span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">headlines</span><span class="s3">)</span><span class="s2">} </span><span class="s4">å€‹ Google News é ­æ¢ (ä¾†æº: </span><span class="s2">{</span><span class="s1">source_name</span><span class="s2">}</span><span class="s4">)ã€‚&quot;</span><span class="s3">)</span>
                <span class="s2">return </span><span class="s1">headlines</span>

            <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;âš ï¸ </span><span class="s2">{</span><span class="s1">source_name</span><span class="s2">} </span><span class="s4">å…§å®¹ç‚ºç©ºã€‚å˜—è©¦ä¸‹ä¸€å€‹å‚™æ´ã€‚&quot;</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s1">Exception </span><span class="s2">as </span><span class="s1">e</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;âŒ ç²å– </span><span class="s2">{</span><span class="s1">source_name</span><span class="s2">} </span><span class="s4">æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤: </span><span class="s2">{</span><span class="s1">e</span><span class="s2">}</span><span class="s4">ã€‚å˜—è©¦ä¸‹ä¸€å€‹å‚™æ´ã€‚&quot;</span><span class="s3">)</span>

    <span class="s0"># å¦‚æœæ‰€æœ‰ RSS éƒ½å¤±æ•—ï¼ŒåŸ·è¡Œéœæ…‹å‚™æ´</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;âŒ æ‰€æœ‰ RSS ä¾†æºå‡å¤±æ•—ã€‚å°‡ä½¿ç”¨éœæ…‹å‚™æ´æŸ¥è©¢ã€‚&quot;</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s3">[]</span>


<span class="s0"># ==========================</span>
<span class="s0"># Phase 1ï¼šæ¢ç´¢äº‹ä»¶ (ä½¿ç”¨ Google News æ¨™é¡Œ)</span>
<span class="s0"># ==========================</span>
<span class="s2">def </span><span class="s1">get_main_events</span><span class="s3">(</span><span class="s1">query</span><span class="s3">=</span><span class="s4">&quot;ä»Šæ—¥æ–°è&quot;</span><span class="s3">):</span>
    <span class="s0"># ğŸŒŸ æ­¥é©Ÿ 1: å‘¼å«æ–°çš„å‡½å¼ç²å– Google News æ¨™é¡Œ (å…§å»ºå‚™æ´)</span>
    <span class="s1">news_titles </span><span class="s3">= </span><span class="s1">get_google_news_headlines</span><span class="s3">(</span><span class="s1">max_results</span><span class="s3">=</span><span class="s5">15</span><span class="s3">)</span>

    <span class="s0"># ğŸŒŸ æ­¥é©Ÿ 2: å®šç¾©å‚™æ´æŸ¥è©¢åˆ—è¡¨ (ä»¥é˜² RSS æŠ“å–å¤±æ•—)</span>
    <span class="s0"># ç”±æ–¼ news_titles å‡½æ•¸å…§éƒ¨å·²ç¶“è™•ç†äº†å¤šé‡ RSS å‚™æ´ï¼Œé€™è£¡åªéœ€è™•ç†æœ€çµ‚å¤±æ•—çš„æƒ…æ³</span>
    <span class="s2">if </span><span class="s1">news_titles</span><span class="s3">:</span>
        <span class="s1">sub_queries </span><span class="s3">= </span><span class="s1">news_titles</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;ğŸ” [Phase 1] æœå°‹ (ä½¿ç”¨ </span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">news_titles</span><span class="s3">)</span><span class="s2">} </span><span class="s4">å€‹ Google News æ¨™é¡Œ) ä¸­...&quot;</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s0"># æœ€çµ‚éœæ…‹å‚™æ´æŸ¥è©¢</span>
        <span class="s1">sub_queries </span><span class="s3">= [</span>
            <span class="s4">&quot;å°ç£ä»Šæ—¥ç†±é–€æ–°è&quot;</span><span class="s3">, </span><span class="s4">&quot;å°ç£é‡å¤§æ”¿ç­–&quot;</span><span class="s3">, </span><span class="s4">&quot;å°ç£å¨›æ¨‚é ­æ¢&quot;</span><span class="s3">, </span><span class="s4">&quot;å°ç£ç¤¾æœƒæ–°è&quot;</span><span class="s3">, </span><span class="s4">&quot;åœ‹éš›æƒ…å‹¢å°å°ç£å½±éŸ¿&quot;</span>
        <span class="s3">]</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;ğŸ” [Phase 1] æœå°‹ (ä½¿ç”¨éœæ…‹å‚™æ´è©å½™) ä¸­...&quot;</span><span class="s3">)</span>

    <span class="s1">all_articles </span><span class="s3">= []</span>

    <span class="s0"># ä½¿ç”¨ Tavily æœå°‹æ­¥é©Ÿä¸è®Š</span>
    <span class="s2">for </span><span class="s1">sub_query </span><span class="s2">in </span><span class="s1">sub_queries</span><span class="s3">:</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s0"># é‡å°æ¯å€‹å­æŸ¥è©¢ç²å–æœ€å¤§å€¼ (15) çš„çµæœ</span>
            <span class="s1">response </span><span class="s3">= </span><span class="s1">tavily_client</span><span class="s3">.</span><span class="s1">search</span><span class="s3">(</span>
                <span class="s1">query</span><span class="s3">=</span><span class="s1">sub_query</span><span class="s3">,</span>
                <span class="s1">max_results</span><span class="s3">=</span><span class="s5">15</span><span class="s3">,</span>
                <span class="s1">include_raw_content</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                <span class="s1">time_range</span><span class="s3">=</span><span class="s4">&quot;day&quot;</span>
            <span class="s3">)</span>
            <span class="s1">all_articles</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">(</span><span class="s1">response</span><span class="s3">[</span><span class="s4">&quot;results&quot;</span><span class="s3">])</span>
        <span class="s2">except </span><span class="s1">Exception </span><span class="s2">as </span><span class="s1">e</span><span class="s3">:</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;âš ï¸ å­æŸ¥è©¢å¤±æ•— (</span><span class="s2">{</span><span class="s1">sub_query</span><span class="s2">}</span><span class="s4">)ï¼š</span><span class="s2">{</span><span class="s1">e</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>

    <span class="s0"># ... (ä»¥ä¸‹å»ºç«‹ context å’Œå‘¼å« Gemini çš„ç¨‹å¼ç¢¼ä¿æŒä¸è®Š) ...</span>
    <span class="s1">context </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
    <span class="s2">for </span><span class="s1">a </span><span class="s2">in </span><span class="s1">all_articles</span><span class="s3">:</span>
        <span class="s1">raw_content </span><span class="s3">= </span><span class="s1">a</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'raw_content'</span><span class="s3">) </span><span class="s2">or </span><span class="s4">''</span>
        <span class="s1">context </span><span class="s3">+= </span><span class="s4">f&quot;ä¾†æº: </span><span class="s2">{</span><span class="s1">a</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'url'</span><span class="s3">, </span><span class="s4">'ç„¡'</span><span class="s3">)</span><span class="s2">}\n</span><span class="s4">æ¨™é¡Œ: </span><span class="s2">{</span><span class="s1">a</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'title'</span><span class="s3">, </span><span class="s4">'ç„¡'</span><span class="s3">)</span><span class="s2">}\n</span><span class="s4">å…§å®¹: </span><span class="s2">{</span><span class="s1">raw_content</span><span class="s3">[:</span><span class="s5">1000</span><span class="s3">]</span><span class="s2">}\n\n</span><span class="s4">---</span><span class="s2">\n\n</span><span class="s4">&quot;</span>

    <span class="s1">prompt </span><span class="s3">= </span><span class="s4">f&quot;&quot;&quot;</span>
    <span class="s4">ä½ æ˜¯ä¸€ä½å°ˆæ¥­æ–°èç·¨è¼¯ã€‚</span>
    <span class="s4">æ ¹æ“šæ‰€æœ‰æ–°èï¼Œè«‹å¹«æˆ‘æç…‰å‡º 3â€“5 å€‹ã€Œç†±é–€äº‹ä»¶ã€ï¼Œ</span>
    <span class="s4">æ¯å€‹ä¸»é¡Œä»¥ä¸€å¥ç°¡çŸ­æ–‡å­—è¡¨ç¤ºã€‚</span>
    <span class="s4">--- é–‹å§‹æ–°èè³‡æ–™ ---</span>
    <span class="s2">{</span><span class="s1">context</span><span class="s2">}</span>
    <span class="s4">--- çµæŸæ–°èè³‡æ–™ ---</span>
    <span class="s4">&quot;&quot;&quot;</span>
    <span class="s1">response </span><span class="s3">= </span><span class="s1">gemini_model</span><span class="s3">.</span><span class="s1">generate_content</span><span class="s3">(</span><span class="s1">prompt</span><span class="s3">)</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;âœ… ä¸»é¡Œæå–å®Œæˆ</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s3">[</span><span class="s1">e</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">(</span><span class="s4">&quot;â€¢&quot;</span><span class="s3">).</span><span class="s1">strip</span><span class="s3">() </span><span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">response</span><span class="s3">.</span><span class="s1">text</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">) </span><span class="s2">if </span><span class="s1">e</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()]</span>


<span class="s0"># ==========================</span>
<span class="s0"># Phase 2ï¼šæŠ“å–å…§å®¹</span>
<span class="s0"># ==========================</span>
<span class="s0"># ==========================</span>
<span class="s0"># Phase 2ï¼šæŠ“å–å…§å®¹ (ä¿æŒä¸è®Š)</span>
<span class="s0"># ==========================</span>
<span class="s2">def </span><span class="s1">get_event_articles</span><span class="s3">(</span><span class="s1">event</span><span class="s3">):</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;ğŸ“° [Phase 2] æ·±åº¦æœå°‹ï¼š</span><span class="s2">{</span><span class="s1">event</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
    <span class="s1">all_articles </span><span class="s3">= []</span>

    <span class="s0"># é€²è¡Œä¸€æ¬¡å»£æ³›æœå°‹</span>
    <span class="s1">query </span><span class="s3">= </span><span class="s1">event</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s0"># å¢åŠ  max_results ä»¥ç²å–æ›´å¤šè³‡æ–™</span>
        <span class="s1">res </span><span class="s3">= </span><span class="s1">tavily_client</span><span class="s3">.</span><span class="s1">search</span><span class="s3">(</span><span class="s1">query</span><span class="s3">=</span><span class="s1">query</span><span class="s3">, </span><span class="s1">max_results</span><span class="s3">=</span><span class="s5">15</span><span class="s3">, </span><span class="s1">include_raw_content</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">time_range</span><span class="s3">=</span><span class="s4">&quot;day&quot;</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">r </span><span class="s2">in </span><span class="s1">res</span><span class="s3">[</span><span class="s4">&quot;results&quot;</span><span class="s3">]:</span>
            <span class="s1">raw_content </span><span class="s3">= </span><span class="s1">r</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;raw_content&quot;</span><span class="s3">) </span><span class="s2">or </span><span class="s4">&quot;&quot;</span>

            <span class="s0"># å¾ URL è§£æä¾†æº (æ›´ç¾è§€çš„é¡¯ç¤º)</span>
            <span class="s1">url_parts </span><span class="s3">= </span><span class="s1">r</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;url&quot;</span><span class="s3">, </span><span class="s4">&quot;ç„¡ç¶²å€&quot;</span><span class="s3">).</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;/&quot;</span><span class="s3">)</span>
            <span class="s1">source </span><span class="s3">= </span><span class="s1">url_parts</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] </span><span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">url_parts</span><span class="s3">) &gt; </span><span class="s5">2 </span><span class="s2">else </span><span class="s4">&quot;æœªçŸ¥ä¾†æº&quot;</span>

            <span class="s0"># ç¢ºä¿å…§å®¹ä¸ç‚ºç©ºæ‰åŠ å…¥ï¼Œæé«˜æ‘˜è¦å“è³ª</span>
            <span class="s2">if </span><span class="s1">raw_content</span><span class="s3">:</span>
                <span class="s1">all_articles</span><span class="s3">.</span><span class="s1">append</span><span class="s3">({</span>
                    <span class="s4">&quot;source&quot;</span><span class="s3">: </span><span class="s1">source</span><span class="s3">,</span>
                    <span class="s4">&quot;title&quot;</span><span class="s3">: </span><span class="s1">r</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;title&quot;</span><span class="s3">, </span><span class="s4">&quot;ç„¡æ¨™é¡Œ&quot;</span><span class="s3">),</span>
                    <span class="s4">&quot;url&quot;</span><span class="s3">: </span><span class="s1">r</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;url&quot;</span><span class="s3">, </span><span class="s4">&quot;ç„¡ç¶²å€&quot;</span><span class="s3">),</span>
                    <span class="s4">&quot;content&quot;</span><span class="s3">: </span><span class="s1">raw_content</span>
                <span class="s3">})</span>

        <span class="s2">return </span><span class="s1">all_articles</span>

    <span class="s2">except </span><span class="s1">Exception </span><span class="s2">as </span><span class="s1">e</span><span class="s3">:</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;âš ï¸ ç„¡æ³•å–å¾— </span><span class="s2">{</span><span class="s1">event</span><span class="s2">} </span><span class="s4">çš„æ·±åº¦æœå°‹å…§å®¹ï¼š</span><span class="s2">{</span><span class="s1">e</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s3">[]</span>


<span class="s0"># ==========================</span>
<span class="s0"># Phase 3ï¼šæ•´åˆæ‘˜è¦</span>
<span class="s0"># ==========================</span>
<span class="s0"># ==========================</span>
<span class="s0"># Phase 3ï¼šæ•´åˆæ‘˜è¦ (ä¿æŒä¸è®Š)</span>
<span class="s0"># ==========================</span>
<span class="s2">def </span><span class="s1">summarize_event</span><span class="s3">(</span><span class="s1">event</span><span class="s3">, </span><span class="s1">articles</span><span class="s3">):</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;ğŸ§  [Phase 3] æ‘˜è¦æ•´åˆï¼š</span><span class="s2">{</span><span class="s1">event</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>

    <span class="s2">if not </span><span class="s1">articles</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s4">f&quot;âš ï¸ è­¦å‘Šï¼šæœªæ‰¾åˆ°é—œæ–¼ã€Œ</span><span class="s2">{</span><span class="s1">event</span><span class="s2">}</span><span class="s4">ã€çš„æœ‰æ•ˆæ–°èæ–‡ç« ï¼Œç„¡æ³•ç”Ÿæˆæ‘˜è¦ã€‚&quot;</span>

    <span class="s1">context </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
    <span class="s2">for </span><span class="s1">art </span><span class="s2">in </span><span class="s1">articles</span><span class="s3">:</span>
        <span class="s1">content_text </span><span class="s3">= </span><span class="s1">art</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'content'</span><span class="s3">) </span><span class="s2">or </span><span class="s4">&quot;&quot;</span>
        <span class="s1">source_text </span><span class="s3">= </span><span class="s1">art</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'source'</span><span class="s3">, </span><span class="s4">'æœªçŸ¥ä¾†æº'</span><span class="s3">)</span>
        <span class="s1">title_text </span><span class="s3">= </span><span class="s1">art</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'title'</span><span class="s3">, </span><span class="s4">'ç„¡æ¨™é¡Œ'</span><span class="s3">)</span>

        <span class="s0"># åªæ“·å–å‰ 750 å­—å…ƒ</span>
        <span class="s1">context </span><span class="s3">+= </span><span class="s4">f&quot;ä¾†æº: </span><span class="s2">{</span><span class="s1">source_text</span><span class="s2">}\n</span><span class="s4">æ¨™é¡Œ: </span><span class="s2">{</span><span class="s1">title_text</span><span class="s2">}\n</span><span class="s4">å…§å®¹: </span><span class="s2">{</span><span class="s1">content_text</span><span class="s3">[:</span><span class="s5">750</span><span class="s3">]</span><span class="s2">}\n\n</span><span class="s4">&quot;</span>

    <span class="s1">prompt </span><span class="s3">= </span><span class="s4">f&quot;&quot;&quot;</span>
    <span class="s4">ä»¥ä¸‹æ˜¯é—œæ–¼ã€Œ</span><span class="s2">{</span><span class="s1">event</span><span class="s2">}</span><span class="s4">ã€çš„å¤šå®¶æ–°èå ±å°ã€‚</span>
    <span class="s4">è«‹å¹«æˆ‘ç¶œåˆé€™äº›å…§å®¹ï¼Œæ’°å¯«ç´„ 500 å­—çš„å®¢è§€æ‘˜è¦ï¼Œ</span>
    <span class="s4">éœ€åŒ…å«ä¸»è¦äº‹å¯¦èˆ‡å„åª’é«”çš„ä¸åŒè§€é»ã€‚</span>

    <span class="s4">--- å ±å°è³‡æ–™ ---</span>
    <span class="s2">{</span><span class="s1">context</span><span class="s2">}</span>
    <span class="s4">--- çµæŸ ---</span>
    <span class="s4">&quot;&quot;&quot;</span>
    <span class="s1">response </span><span class="s3">= </span><span class="s1">gemini_model</span><span class="s3">.</span><span class="s1">generate_content</span><span class="s3">(</span><span class="s1">prompt</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">response</span><span class="s3">.</span><span class="s1">text</span>


<span class="s0"># ==========================</span>
<span class="s0"># Phase 4ï¼šå‘ˆç¾</span>
<span class="s0"># ==========================</span>
<span class="s2">def </span><span class="s1">generate_news_report</span><span class="s3">():</span>
    <span class="s1">main_events </span><span class="s3">= </span><span class="s1">get_main_events</span><span class="s3">()</span>
    <span class="s1">report </span><span class="s3">= {}</span>

    <span class="s2">for </span><span class="s1">event </span><span class="s2">in </span><span class="s1">main_events</span><span class="s3">[:</span><span class="s5">5</span><span class="s3">]:  </span><span class="s0"># å¯èª¿æ•´è¦æ‘˜è¦çš„äº‹ä»¶æ•¸é‡</span>
        <span class="s1">articles </span><span class="s3">= </span><span class="s1">get_event_articles</span><span class="s3">(</span><span class="s1">event</span><span class="s3">)</span>
        <span class="s2">if not </span><span class="s1">articles</span><span class="s3">:</span>
            <span class="s2">continue</span>
        <span class="s1">summary </span><span class="s3">= </span><span class="s1">summarize_event</span><span class="s3">(</span><span class="s1">event</span><span class="s3">, </span><span class="s1">articles</span><span class="s3">)</span>
        <span class="s1">report</span><span class="s3">[</span><span class="s1">event</span><span class="s3">] = </span><span class="s1">summary</span>

    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">==================== ğŸ—ï¸ ä»Šæ—¥ç¶œåˆæ–°èæ‘˜è¦ ====================&quot;</span><span class="s3">)</span>
    <span class="s2">for </span><span class="s1">topic</span><span class="s3">, </span><span class="s1">summary </span><span class="s2">in </span><span class="s1">report</span><span class="s3">.</span><span class="s1">items</span><span class="s3">():</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">\n</span><span class="s4">ğŸŸ¦ </span><span class="s2">{</span><span class="s1">topic</span><span class="s2">}\n{</span><span class="s1">summary</span><span class="s2">}\n{</span><span class="s4">'-' </span><span class="s3">* </span><span class="s5">60</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
    <span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;==============================================================&quot;</span><span class="s3">)</span>


<span class="s0"># ==========================</span>
<span class="s0"># ä¸»ç¨‹å¼å…¥å£</span>
<span class="s0"># ==========================</span>
<span class="s2">if </span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;__main__&quot;</span><span class="s3">:</span>
    <span class="s1">generate_news_report</span><span class="s3">()</span></pre>
</body>
</html>